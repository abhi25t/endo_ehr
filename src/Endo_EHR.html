<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AIG Endoscopy Report</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Inter, system-ui, sans-serif; }
    .loc-column { min-height: 320px; max-height: 420px; overflow:auto; }
    .pill, .attr-pill {
      cursor:pointer; border:1px solid #93c5fd; background:#fff;
      color:#1e40af; padding:.35rem .6rem; border-radius:.5rem;
      font-size:.875rem; transition:all .15s;
    }
    .pill:hover, .attr-pill:hover { background:#eff6ff; }
    .pill-selected, .attr-pill.selected {
      background:#2563eb; color:#fff; border-color:#1d4ed8;
    }
    .left-disease {
      display:block; text-align:left; width:100%;
      padding:.5rem .75rem; border-radius:.5rem;
      border:1px solid transparent; background:#fff; color:#1f2937;
    }
    .left-disease:hover { background:#f1f5f9; }
    .left-disease.selected {
      background:#2563eb; color:#fff; border-color:#1e40af;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800">
<div class="max-w-full mx-auto p-6">
  <h1 class="text-2xl font-bold text-center text-blue-700 mb-6">AIG Endoscopy Report</h1>

  <!-- Retrospective Analysis Controls -->
  <div class="mb-3 bg-white p-4 rounded shadow">
    <div class="flex items-center gap-6 flex-wrap">
      <!-- Load Videos Folder Button -->
      <button id="loadVideoFolder" class="bg-purple-600 text-white px-3 py-2 rounded text-sm hover:bg-purple-700">
        üìÅ Load Videos Folder
      </button>

      <!-- UHID Dropdown -->
      <div class="flex items-center gap-2">
        <label class="text-sm font-medium text-gray-700">UHID:</label>
        <select id="uhidSelect" class="border rounded p-2 text-sm min-w-[150px]">
          <option value="">-- Select UHID --</option>
        </select>
      </div>

      <!-- Video Dropdown -->
      <div class="flex items-center gap-2">
        <label class="text-sm font-medium text-gray-700">Video:</label>
        <select id="videoSelect" class="border rounded p-2 text-sm min-w-[200px]" disabled>
          <option value="">-- Select Video --</option>
        </select>
      </div>

      <!-- Frame Range Inputs -->
      <div class="flex items-center gap-2">
        <label class="text-sm font-medium text-gray-700">Start Frame:</label>
        <input type="number" id="startFrame" class="border rounded p-2 text-sm w-24" min="0" step="1" placeholder="0" />
      </div>

      <div class="flex items-center gap-2">
        <label class="text-sm font-medium text-gray-700">End Frame:</label>
        <input type="number" id="endFrame" class="border rounded p-2 text-sm w-24" min="0" step="1" placeholder="0" />
      </div>

      <!-- Frame Count and Duration Display -->
      <div class="flex items-center gap-4 text-sm">
        <span class="text-gray-700"># Frames: <strong id="frameCount">0</strong></span>
        <span class="text-gray-700">Duration: <strong id="durationSec">0.00</strong> sec</span>
      </div>

      <!-- Segmentation Frame Input -->
      <div class="flex items-center gap-2">
        <label class="text-sm font-medium text-gray-700">Segmentation Frame:</label>
        <input type="number" id="segmentationFrame" class="border rounded p-2 text-sm w-24" min="0" step="1" placeholder="0" />
      </div>

      <!-- PII Pill Toggle -->
      <button id="piiToggle" class="px-3 py-2 rounded text-sm border-2 border-orange-400 bg-white text-orange-600 hover:bg-orange-50">
        PII
      </button>

      <!-- Voice Dictation Toggle -->
      <button id="voiceToggle" disabled
        class="bg-green-600 text-white px-4 py-2 rounded text-sm hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed"
        title="Load CSV first">
        Start Dictation
      </button>
      <span id="voiceStatus" class="text-sm text-gray-500"></span>

      <!-- CSV Loading (moved to right side) -->
      <div class="flex items-center gap-2 ml-auto">
        <input id="csvFile" type="file" accept=".csv" class="text-sm" />
        <button id="loadSample" class="px-3 py-1 rounded border text-sm bg-white hover:bg-gray-50">Load sample</button>
      </div>
    </div>
    <div id="csvNote" class="text-sm text-yellow-700 mt-2"></div>
    <!-- Voice Transcript Bar -->
    <div id="voiceTranscriptBar" class="hidden mt-2 px-3 py-2 bg-gray-50 rounded border border-gray-200 flex items-center gap-2">
      <span class="text-xs font-medium text-gray-500 shrink-0">Transcript:</span>
      <span id="voiceTranscriptText" class="text-sm truncate text-gray-400 italic"></span>
    </div>
  </div>

  <div class="flex gap-6">
    <!-- LEFT -->
    <div class="w-3/4 space-y-4">
      <div class="bg-white p-4 rounded shadow">
        <div class="grid grid-cols-4 gap-4">
          <div>
            <h3 class="text-blue-600 font-semibold mb-2">Esophagus</h3>
            <div id="col-esophagus" class="loc-column space-y-2"></div>
          </div>
          <div>
            <h3 class="text-blue-600 font-semibold mb-2">GE Junction</h3>
            <div id="col-gejunction" class="loc-column space-y-2"></div>
          </div>
          <div>
            <h3 class="text-blue-600 font-semibold mb-2">Stomach</h3>
            <div id="col-stomach" class="loc-column space-y-2"></div>
          </div>
          <div>
            <h3 class="text-blue-600 font-semibold mb-2">Duodenum</h3>
            <div id="col-duodenum" class="loc-column space-y-2"></div>
          </div>
        </div>
        <div class="mt-4 bg-blue-50 p-4 rounded">
          <div class="font-medium mb-2 text-sm text-gray-700">
            Sub-Location <span class="text-xs italic text-gray-500">(multi-select)</span>
          </div>
          <div id="subloc-chips" class="flex gap-2 flex-wrap"></div>
        </div>
      </div>

      <div id="detailsCard" class="bg-white p-4 rounded shadow hidden">
        <div class="mb-3">
          <div class="text-lg font-semibold" id="detailsTitle">Details</div>
          <div class="text-sm text-gray-500" id="detailsSubTitle"></div>
        </div>

        <!-- Disease-specific Frame Controls -->
        <div class="mb-4 p-3 bg-blue-50 rounded border border-blue-200">
          <div class="flex items-center gap-4 flex-wrap">
            <div class="flex items-center gap-2">
              <label class="text-sm font-medium text-gray-700">Start Frame:</label>
              <input type="number" id="diseaseStartFrame" class="border rounded p-1 text-sm w-20" min="0" step="1" placeholder="0" />
            </div>
            <div class="flex items-center gap-2">
              <label class="text-sm font-medium text-gray-700">End Frame:</label>
              <input type="number" id="diseaseEndFrame" class="border rounded p-1 text-sm w-20" min="0" step="1" placeholder="0" />
            </div>
            <div class="flex items-center gap-3 text-sm">
              <span class="text-gray-700"># Frames: <strong id="diseaseFrameCount">0</strong></span>
              <span class="text-gray-700">Duration: <strong id="diseaseDurationSec">0.00</strong> sec</span>
            </div>
            <div class="flex items-center gap-2">
              <label class="text-sm font-medium text-gray-700">Segmentation Frame:</label>
              <input type="number" id="diseaseSegmentationFrame" class="border rounded p-1 text-sm w-20" min="0" step="1" placeholder="0" />
            </div>
          </div>
        </div>

        <div id="detailsSections" class="space-y-4"></div>
        <div class="mt-4">
          <label class="block font-medium mb-1">Additional Comments</label>
          <textarea id="diseaseComments" rows="3" class="w-full p-2 border rounded" placeholder="Comments..."></textarea>
        </div>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="w-1/4">
      <div class="bg-white p-4 rounded shadow">
        <div class="flex justify-between items-center mb-3">
          <h2 class="text-lg font-semibold">Report</h2>
          <div class="flex gap-2">
            <button id="saveJSON" class="bg-green-600 text-white px-3 py-1 rounded text-sm">Save</button>
            <button id="loadSavedJSON" class="bg-blue-600 text-white px-3 py-1 rounded text-sm">Load Saved JSON</button>
            <button id="clearReport" class="bg-red-600 text-white px-3 py-1 rounded text-sm">Clear</button>
          </div>
        </div>
        <div id="reportContent" class="space-y-4 min-h-[40vh]"></div>
      </div>
      <div class="bg-white mt-4 p-4 rounded shadow">
        <label class="block font-medium mb-1">Overall Remarks</label>
        <textarea id="overallRemarks" rows="4" class="w-full p-2 border rounded" placeholder="Overall remarks"></textarea>
      </div>
    </div>
  </div>
</div>

<!-- hidden file input for loading saved JSON -->
<input id="jsonFile" type="file" accept="application/json, .json" style="display:none" />

<script src="js/01-debug.js"></script>
<script src="js/02-csv-parser.js"></script>
<script src="js/03-hint-helpers.js"></script>
<script src="js/04-input-helpers.js"></script>
<script src="js/05-constants.js"></script>
<script src="js/06-state.js"></script>
<script src="js/07-conditional-logic.js"></script>
<script src="js/08-disease-columns.js"></script>
<script src="js/09-sublocation-ui.js"></script>
<script src="js/10-disease-management.js"></script>
<script src="js/11-details-pane.js"></script>
<script src="js/12-report-pane.js"></script>
<script src="js/13-retro-video.js"></script>
<script src="js/14-json-io.js"></script>
<script src="js/15-pdf-generation.js"></script>
<script src="js/16-save-report.js"></script>
<script src="js/17-csv-upload.js"></script>
<script src="js/18-init.js"></script>
<script src="js/19-voice.js"></script>
</body>
</html>
